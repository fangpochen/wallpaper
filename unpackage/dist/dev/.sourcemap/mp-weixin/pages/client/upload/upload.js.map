{"version":3,"sources":["uni-app:///main.js","webpack:///F:/微信小程序/头像/pages/client/upload/upload.vue?1c59","webpack:///F:/微信小程序/头像/pages/client/upload/upload.vue?241a","webpack:///F:/微信小程序/头像/pages/client/upload/upload.vue?0b2d","webpack:///F:/微信小程序/头像/pages/client/upload/upload.vue?0db4","uni-app:///pages/client/upload/upload.vue","webpack:///F:/微信小程序/头像/pages/client/upload/upload.vue?b2d2","webpack:///F:/微信小程序/头像/pages/client/upload/upload.vue?1ac3"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","isAdmin","tempFilePath","title","typeIndex","typeArray","id","name","onLoad","uni","icon","duration","complete","setTimeout","methods","chooseImage","count","sizeType","sourceType","success","bindPickerChange","uploadImage","cloudPath","filePath","uploadRes","action","type","fileID","createTime","result","console"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAmH;AACnH;AAC0D;AACL;AACa;;;AAGlE;AACsM;AACtM,gBAAgB,6MAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,iFAAM;AACR,EAAE,0FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAqwB,CAAgB,gxBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eC8BzxB;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC,YACA;QAAAC;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA;IAEA;EACA;EACAC;IACA;IACA;IACA;MACA;IACA;MACAC;QACAN;QACAO;QACAC;QACAC;UACAC;YACAJ;UACA;QACA;MACA;IACA;EACA;EACAK;IACA;IACAC;MAAA;MACAN;QACAO;QACAC;QACAC;QACAC;UACA;QACA;MACA;IACA;IAEA;IACAC;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBACAZ;kBACAN;kBACAO;gBACA;gBAAA;cAAA;gBAIAD;kBACAN;gBACA;gBAAA;gBAGA;gBACAmB;gBAAA;gBAAA,OACA3B;kBACA2B;kBACAC;gBACA;cAAA;gBAHAC;gBAAA;gBAAA,OAMA7B;kBACAY;kBACAP;oBACAyB;oBACAzB;sBACAG;sBACAuB;sBACAC;sBACAC;oBACA;kBACA;gBACA;cAAA;gBAXAC;gBAAA,MAaAA;kBAAA;kBAAA;gBAAA;gBACApB;kBACAN;kBACAO;gBACA;gBACA;gBACA;gBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA,MAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAoB;gBACArB;kBACAN;kBACAO;gBACA;cAAA;gBAAA;gBAEAD;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC3IA;AAAA;AAAA;AAAA;AAAylC,CAAgB,qkCAAG,EAAC,C;;;;;;;;;;;ACA7mC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/client/upload/upload.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/client/upload/upload.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./upload.vue?vue&type=template&id=22de2d04&\"\nvar renderjs\nimport script from \"./upload.vue?vue&type=script&lang=js&\"\nexport * from \"./upload.vue?vue&type=script&lang=js&\"\nimport style0 from \"./upload.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/client/upload/upload.vue\"\nexport default component.exports","export * from \"-!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./upload.vue?vue&type=template&id=22de2d04&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./upload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./upload.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<view v-if=\"isAdmin\">\r\n\t\t\t<view class=\"upload-section\">\r\n\t\t\t\t<button class=\"upload-btn\" @tap=\"chooseImage\">选择图片</button>\r\n\t\t\t\t<view class=\"preview\" v-if=\"tempFilePath\">\r\n\t\t\t\t\t<image :src=\"tempFilePath\" mode=\"aspectFit\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form-section\">\r\n\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t<text>标题：</text>\r\n\t\t\t\t\t<input v-model=\"title\" placeholder=\"请输入标题\"/>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t<text>分类：</text>\r\n\t\t\t\t\t<picker @change=\"bindPickerChange\" :value=\"typeIndex\" :range=\"typeArray\" range-key=\"name\">\r\n\t\t\t\t\t\t<view class=\"picker\">{{typeArray[typeIndex].name}}</view>\r\n\t\t\t\t\t</picker>\r\n\t\t\t\t</view>\r\n\t\t\t\t<button class=\"submit-btn\" @tap=\"uploadImage\" :disabled=\"!tempFilePath\">上传图片</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view v-else class=\"no-permission\">\r\n\t\t\t<text>抱歉，只有管理员才能上传图片</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tisAdmin: false,\r\n\t\t\ttempFilePath: '',\r\n\t\t\ttitle: '',\r\n\t\t\ttypeIndex: 0,\r\n\t\t\ttypeArray: [\r\n\t\t\t\t{ id: 98, name: '小姐姐' },\r\n\t\t\t\t{ id: 101, name: '小哥哥' },\r\n\t\t\t\t{ id: 104, name: '精品头像' }\r\n\t\t\t]\r\n\t\t}\r\n\t},\r\n\tonLoad() {\r\n\t\t// 检查是否是管理员\r\n\t\tconst userInfo = uni.getStorageSync(\"userinfo\");\r\n\t\tif (userInfo && userInfo.user_id === 1) {\r\n\t\t\tthis.isAdmin = true;\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '无权限访问',\r\n\t\t\t\ticon: 'none',\r\n\t\t\t\tduration: 2000,\r\n\t\t\t\tcomplete: () => {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t\t}, 2000);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t// 选择图片\r\n\t\tchooseImage() {\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tcount: 1,\r\n\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tthis.tempFilePath = res.tempFilePaths[0]\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t// 分类选择\r\n\t\tbindPickerChange(e) {\r\n\t\t\tthis.typeIndex = e.detail.value\r\n\t\t},\r\n\t\t\r\n\t\t// 上传图片\r\n\t\tasync uploadImage() {\r\n\t\t\tif (!this.tempFilePath) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请选择图片',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tuni.showLoading({\r\n\t\t\t\ttitle: '上传中...'\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\t// 1. 上传图片到云存储\r\n\t\t\t\tconst cloudPath = `wallpapers/${Date.now()}-${Math.random().toString(36).slice(-6)}.jpg`\r\n\t\t\t\tconst uploadRes = await wx.cloud.uploadFile({\r\n\t\t\t\t\tcloudPath,\r\n\t\t\t\t\tfilePath: this.tempFilePath\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\t// 2. 保存信息到数据库\r\n\t\t\t\tconst result = await wx.cloud.callFunction({\r\n\t\t\t\t\tname: 'wallpaper',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'addWallpaper',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\ttitle: this.title,\r\n\t\t\t\t\t\t\ttype: this.typeArray[this.typeIndex].id,\r\n\t\t\t\t\t\t\tfileID: uploadRes.fileID,\r\n\t\t\t\t\t\t\tcreateTime: new Date()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (result.result.code === 0) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '上传成功',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// 清空表单\r\n\t\t\t\t\tthis.tempFilePath = ''\r\n\t\t\t\t\tthis.title = ''\r\n\t\t\t\t\tthis.typeIndex = 0\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('上传失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(err)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '上传失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t} finally {\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n\tpadding: 20rpx;\r\n}\r\n.upload-section {\r\n\tmargin-bottom: 30rpx;\r\n}\r\n.preview {\r\n\tmargin-top: 20rpx;\r\n\twidth: 100%;\r\n\theight: 400rpx;\r\n\tbackground-color: #f8f8f8;\r\n}\r\n.preview image {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n}\r\n.form-section {\r\n\tbackground-color: #fff;\r\n\tpadding: 20rpx;\r\n\tborder-radius: 10rpx;\r\n}\r\n.form-item {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tmargin-bottom: 20rpx;\r\n\tpadding: 10rpx 0;\r\n}\r\n.form-item text {\r\n\twidth: 120rpx;\r\n}\r\n.picker {\r\n\tflex: 1;\r\n}\r\n.submit-btn {\r\n\tmargin-top: 30rpx;\r\n\tbackground-color: #007AFF;\r\n\tcolor: #fff;\r\n}\r\n.submit-btn[disabled] {\r\n\tbackground-color: #ccc;\r\n}\r\n.no-permission {\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n\theight: 100vh;\r\n}\r\n</style> ","import mod from \"-!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./upload.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\Administrator\\\\Downloads\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./upload.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1737809184329\n      var cssReload = require(\"C:/Users/Administrator/Downloads/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}